<Page
    x:Class="WpfDemo.View.page.StudentView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:WpfDemo.View.page"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:vm="clr-namespace:WpfDemo.ViewModel"
    Title="StudentView"
    d:DesignHeight="450"
    d:DesignWidth="800"
    mc:Ignorable="d">
    <Page.Resources>
        <Style TargetType="TextBox">
            <Style.Triggers>
                <Trigger Property="Validation.HasError" Value="true">
                    <Setter Property="ToolTip" Value="{Binding RelativeSource={RelativeSource Self}, Path=(Validation.Errors)[0].ErrorContent}" />
                </Trigger>
            </Style.Triggers>
        </Style>
    </Page.Resources>
    <Grid>
        <!--  标题  -->
        <Border
            Grid.Row="0"
            Grid.Column="1"
            Margin="0,0,0,8"
            Padding="24,16,0,16"
            Background="White"
            CornerRadius="0,0,8,8">
            <TextBlock
                FontSize="22"
                FontWeight="Bold"
                Foreground="#1976D2"
                Text="学生信息管理" />
        </Border>

        <!--  内容区  -->
        <Grid
            Grid.Row="1"
            Grid.Column="1"
            Margin="0,0,0,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="160" />
            </Grid.ColumnDefinitions>
            <!--  学生信息表格  -->
            <Border
                Grid.Column="0"
                Margin="0,0,25,10"
                Padding="16"
                Background="White"
                BorderBrush="#E0E0E0"
                BorderThickness="1"
                CornerRadius="8">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>
                    <StackPanel>
                        <TextBlock
                            Margin="0,0,0,12"
                            FontSize="16"
                            FontWeight="Bold"
                            Text="学生列表" />
                        <StackPanel Margin="0,0,0,12" Orientation="Horizontal">
                            <TextBox
                                x:Name="FilterTextBox"
                                Width="180"
                                Margin="0,0,8,0"
                                VerticalAlignment="Center"
                                Text="{Binding FilterText, UpdateSourceTrigger=PropertyChanged}" />
                            <Button
                                Width="60"
                                Command="{Binding FilterStudentsCommand}"
                                CommandParameter="{Binding FilterText}"
                                Content="筛选" />
                        </StackPanel>
                    </StackPanel>
                    <DataGrid
                        Name="list"
                        Grid.Row="1"
                        Margin="0,0,0,0"
                        AutoGenerateColumns="False"
                        GridLinesVisibility="Horizontal"
                        HeadersVisibility="Column"
                        HorizontalGridLinesBrush="#E0E0E0"
                        IsReadOnly="True"
                        ItemsSource="{Binding Students}"
                        SelectedItem="{Binding SelectedStudent}"
                        SelectionMode="Single"
                        SelectionUnit="FullRow">
                        <DataGrid.Columns>
                            <DataGridTextColumn
                                Width="80"
                                Binding="{Binding Id}"
                                Header="学号" />
                            <DataGridTextColumn
                                Width="120"
                                Binding="{Binding FullName}"
                                Header="姓名" />
                            <DataGridTextColumn
                                Width="100"
                                Binding="{Binding EnrollmentDate, StringFormat='yyyy-MM-dd'}"
                                Header="选课日期" />
                            <DataGridTemplateColumn Width="120" Header="操作">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <StackPanel Orientation="Horizontal">
                                            <Button
                                                Margin="0,0,4,0"
                                                Padding="4,2"
                                                Click="EditStudentButton_Click"
                                                Content="编辑" />
                                            <Button
                                                Margin="0,0,4,0"
                                                Padding="4,2"
                                                Command="{Binding DataContext.DeleteStudentCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                                CommandParameter="{Binding Id}"
                                                Content="删除" />
                                        </StackPanel>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                        </DataGrid.Columns>
                    </DataGrid>

                    <StackPanel Grid.Row="2" Orientation="Horizontal">
                        <TextBox
                            x:Name="page"
                            Width="85"
                            Margin="180,0,10,0"
                            Text="{Binding Page, ValidatesOnExceptions=True}" />
                        <Button
                            x:Name="pageButton"
                            Width="100"
                            Command="{Binding PageStudentCommand}"
                            CommandParameter="{Binding Text, ElementName=page}"
                            Content="跳转" />
                    </StackPanel>
                </Grid>
            </Border>
            <!--  操作按钮  -->
            <StackPanel
                Grid.Column="1"
                Margin="0,0,0,0"
                VerticalAlignment="Top">
                <TextBlock Text="" />
                <Button
                    Width="80"
                    Height="30"
                    Margin="5,0,0,10"
                    Click="AddStudentButton_Click"
                    Content="添加学生" />
                <Button
                    Width="80"
                    Height="30"
                    Margin="5,0,0,10"
                    Click="EditStudentButton_Click"
                    Content="编辑学生" />
                <Button
                    Width="80"
                    Height="30"
                    Margin="5,0,0,10"
                    Command="{Binding DeleteStudentCommand}"
                    CommandParameter="{Binding SelectedStudent.Id}"
                    Content="删除" />
                <Button
                    Width="80"
                    Height="30"
                    Margin="5,0,0,10"
                    Command="{Binding LoadStudentsCommand}"
                    Content="刷新" />
            </StackPanel>
        </Grid>
    </Grid>
</Page>
